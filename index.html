<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlantWater</title>
    <link rel="stylesheet" href="assets/style/style.css">
</head>
<body>
    <div class="home">
        <div class="mdblock">
            <h1>An open source, <b>Arduino</b>, plant watering project</h1>
            <div class="buttons">
                <div class="button"><p>Purchase</p><p>Get all parts and software preconfigured</p></div>
                <div class="button"><p>Read tutorial</p><p>A step by step tutorial to make it yourself</p></div>
            </div>
        </div>
    </div>
    <div class="panel about">
        <div class="mdblock">
            <h1>About the project</h1>
            <p>Built to serve plants...</p>
        </div>
    </div>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
            "three": "https://unpkg.com/three@0.152.2/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.152.2/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        const canvas = document.createElement("canvas");
        canvas.classList.add("threejs")
        document.body.appendChild(canvas);

        const scene = new THREE.Scene();
        const colorWhite = new THREE.Color();
        // scene.background = colorWhite;

        // fix camera init (ratio)
        const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

        const renderer = new THREE.WebGLRenderer({canvas: canvas, antialias: true, alpha: true });
        function sizeRenderer(){
            const width = window.innerWidth - 20;
            // I wanna change height to more
            // to not look weird, but aspect
            // ratios are weird.
            const height = 900;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            positionUpdate();
        }
        sizeRenderer();
        document.body.appendChild( renderer.domElement );

        // const geometry = new THREE.BoxGeometry( 1, .15, 1 );
        // const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
        // const cube = new THREE.Mesh( geometry, material );
        // scene.add( cube );

        const loader = new GLTFLoader();
        var arduinoModel;
        function positionUpdate(){
            if(arduinoModel){
                arduinoModel.position.x = (window.innerWidth/1000) - .4;
            }
        }

        loader.load('assets/models/arduino_uno.glb', function (gltf) {
            arduinoModel = gltf.scene;
            arduinoModel.position.x = .6;
            // arduinoModel.rotation.x = -.75;
            // arduinoModel.rotation.z = .15;
            // arduinoModel.rotation.y = .15;
            arduinoModel.rotation.x = -.62;
            arduinoModel.rotation.y = -.276;
            arduinoModel.rotation.z = -.25;
            scene.add(arduinoModel);
        }, undefined, function ( error ) {
            console.error( error );
        });

        loader.load('assets/models/monstera_deliciosa_potted_mid-century_plant.glb', function (gltf) {
            gltf.scene.position.x = -1;
            gltf.scene.position.y = -.5;
            gltf.scene.position.z = 1;
            // gltf.scene.rotation.x = .75;
            // gltf.scene.rotation.z = .15;
            // gltf.scene.rotation.y = .15;
            scene.add(gltf.scene);
        }, undefined, function ( error ) {
            console.error( error );
        });

        // Lights
        const ambientLight = new THREE.AmbientLight( 0xbbbbbb );
        scene.add( ambientLight );

        const pointLight = new THREE.PointLight( 0x00ff00, 4, 40 );
        pointLight.position.set( -10, 2, 10 );
        scene.add( pointLight );

        // Line
        function line(){
            const material = new THREE.LineBasicMaterial( { color: 0x00bfcd } );
            const points = [];
            points.push( new THREE.Vector3( -3, -1, 0 ) );
            points.push( new THREE.Vector3( 0, -.5, 0 ) );
            points.push( new THREE.Vector3( 3, -1, 0 ) );

            const geometry = new THREE.BufferGeometry().setFromPoints( points );
            const line = new THREE.Line( geometry, material );
            return line;
        }
        scene.add( line() );

        // Camera view
        camera.position.x = 0;
        camera.position.y = 0;
        camera.position.z = 2;

        // camera.rotation.x = 5;

        // Run render
        function animate() {
            requestAnimationFrame( animate );

            // arduinoModel.rotation.x += .001
            // camera.rotation.x += .004;
            // camera.position.y += 0.01
            // cube.rotation.x += 0.001;
            // cube.rotation.y += 0.01;

            renderer.render( scene, camera );
        }

        animate();

        // Resize on resize
        window.addEventListener('resize', onWindowResize, false);
        var resizeTimeout = {duration: 50};

        function onWindowResize(){
            clearTimeout(resizeTimeout.timeout);
            resizeTimeout.timeout = setTimeout(function(){
                sizeRenderer();
            }, resizeTimeout.duration);
        }
    </script>
</body>
</html>